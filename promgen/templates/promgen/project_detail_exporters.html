{% load i18n %}

<div class="panel panel-primary">
  <div class="panel-heading">Exporters</div>
  <table class="table">
    <tr>
      <th>Job</th>
      <th>Port</th>
      <th>Path</th>
      <th colspan="4">Actions</th>
    </tr>
  {% for exporter in project.exporter_set.all %}
    <tr {% if not exporter.enabled %}class="promgen-disabled"{% endif %}>

      <td>{{ exporter.job }}</td>
      <td>{{ exporter.scheme }}:{{ exporter.port }}</td>
      <td>{{ exporter.path | default:"/metrics" }}</td>
      <td style="white-space: nowrap">
        <input
          type="checkbox"
          {% if exporter.enabled %}checked{% endif %}
          data-size="mini"
          data-toggle="toggle"
          data-csrfmiddlewaretoken="{{csrf_token}}"
          data-action="{% url 'exporter-toggle' exporter.id %}"
        />
      </td>
      <td>
        <div class="dropdown">
          <button class="btn btn-default btn-xs dropdown-toggle" type="button" id="exporter-{{ exporter.id }}-labels"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">

            {% trans "Labels" %}
            <span class="caret"></span>
          </button>
          <div class="dropdown-menu" aria-labelledby="exporter-{{ exporter.id }}-labels">
            <table class="table" style="margin-bottom: 0">
            <thead>
            <tr>
              <th>Name</th>
              <th>Value</th>
            </tr>
            </thead>
            <tbody>
            {% for label in exporter.exporterlabel_set.all %}
              <tr>
                <td>{{ label.name }}</td>
                <td>{{ label.value }}</td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
          </div>
        </div>
      </td>
      <td>
        <form id="{{exporter.job}}_{{exporter.port}}">
          {% csrf_token %}
          <input type="hidden" name="exporter_id" value="{{ exporter.id }}" />
          <exporter-test class="btn btn-info btn-xs" href="{% url 'api:project-scrape' name=project.name %}" target="#exporterresult">
            {% trans "Test" %}
          </exporter-test>
        </form>
      </td>
      <td>
        <a
          @click="setSilenceDataset"
          class="btn btn-warning btn-xs"
          data-job="{{exporter.job}}"
          data-project="{{project.name}}"
          data-service="{{project.service.name}}"
          style="display: inline-block;"
        >{% trans "Silence" %}</a>
      </td>
      <td>
        <form method="post" action="{% url 'exporter-delete' exporter.id %}" onsubmit="return confirm('{% trans 'Delete this exporter?' %}')" style="display: inline">
          {% csrf_token %}
          <button class="btn btn-danger btn-xs">{% trans "Delete" %}</button>
        </form>
      </td>
    </tr>
  {% endfor %}
  </table>
  <div class="panel-footer">
    <a href="{% url 'project-exporter' project.id %}" class="btn btn-primary">{% trans "Register Exporter" %}</a>
  </div>
</div>

<div id="exporterresult" style="display:none;"></div>
